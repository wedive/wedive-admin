<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/polymer-apigility/rest/form/rest-form.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../dropdown-menu/dropdown-menu-input.html">
<link rel="import" href="../../entity-image/entity-image.html">
<link rel="import" href="../place-gallery/partial/crud.html">

<dom-module id="strapieno-place-put">
    <template>
        <style>
            .lh-ej {
                @apply(--layout-horizontal);
                @apply(--layout-end-justified);
            }

            .lh {
                @apply(--layout-horizontal);
            }

            #place-gallery {
                padding-left: 108px;
                min-height: 150px;
            }

            #place-gallery form {
               padding-right: 16px;
            }

            #placeCover {
                padding-left: 24px;
            }

            place-gallery-crud {
                margin-left: 16px;;
            }
        </style>
        <div id="place-gallery" class="lh">
            <form
                    id="placeGallery"
                    is="apigility-rest-form"
                    content-type="multipart/form-data"
                    auth="[[auth]]">
                <apigility-resource resource-name="rest/place" identifier="[[placeId]]" has-identifier>
                    <apigility-resource resource-name="gallery">
                    </apigility-resource>
                </apigility-resource>
                <file-input label="Upload gallery" name="blob" auto-send></file-input>
            </form>
            <template is="dom-repeat" items="{{entity.collection}}">
                <place-gallery-crud entity="{{item}}" sizing="cover" place-id={{entity.id}}  auth="[[auth]]"></place-gallery-crud>
            </template>
        </div>
        <div class="lh">
            <entity-image entity="{{entity}}" image-field="cover" sizing="cover"></entity-image>
            <form
                    id="placeCover"
                    is="apigility-rest-form"
                    content-type="multipart/form-data"
                    auth="[[auth]]">
                <apigility-resource resource-name="rest/place" identifier="[[placeId]]" has-identifier i-am-entity>
                    <apigility-resource resource-name="cover">
                    </apigility-resource>
                </apigility-resource>
                <file-input label="Upload cover" name="blob" auto-send></file-input>
            </form>
        </div>
        <form id="placePut"
            is="apigility-rest-form"
            identify="{{placeId}}"
            entity="{{entity}}"
            update-method="PATCH"
            auth="{{auth}}"
            auto-load="{{loadPlace}}">
            <apigility-resource resource-name="rest/place" identifier="[[placeId]]" has-identifier></apigility-resource>
            <paper-input name="name" label="Nome"></paper-input>
            <paper-input name="max_depth" label="Profodità"></paper-input>
            <paper-input name="visibility" label="Visibilità"></paper-input>
            <paper-input name="current" label="Corrente"></paper-input>
            <paper-textarea name="description" label="Descrizione"></paper-textarea>
            <div class="layout horizontal end-justified">
                <paper-button submit-button raised>SAVE</paper-button>
            </div>
        </form>
    </template>
    <script>
        (function() {
            'use strict';

            Polymer({
                is: 'strapieno-place-put',

                ready : function () {
                  this.$.placeCover.addEventListener('rest-form-response', this.coverResponseHandler.bind(this))
                },

                coverResponseHandler : function (event) {
                    this.$.placePut.$.restClient.get();
                }
            });


        })();
    </script>

</dom-module>